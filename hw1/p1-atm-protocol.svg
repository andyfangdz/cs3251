<svg version="1.1" id="mscgenjs__svg" class="mscgenjs__svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="464" height="1056" viewBox="0 0 464 1056"><desc>

# Generated by mscgen_js - https://sverweij.github.io/mscgen_js
msc {
  
  hscale="1.4", wordwraparcs=on, arcgradient = 8;

  c [label="ATM"], s [label="Bank"];
  
  
  --- [label="User inserts card; ATM wakes up from idle"];
  c =&gt; s [label="ID; ATM auth request with public key"];
  --- [label="Bank confirms public key belongs to authorized ATM"];
  s =&gt; c [label="Auth challenge with random number C"];
  c =&gt; s [label="AUTH(sig(C)); sig(C) signed with ATM private key"];
  --- [label="Bank confirms sig(C) is signed with ATM private key"];
  s =&gt; c [label="Auth token with 5 minute timeout"];
  
  --- [label="ATM makes further requests with auth token"];
  --- [label="Bank only serves non-auth requests with valid auth token"];
  
  --- [label="ATM prompts user for password"];
  c =&gt; s [label="CARD_AUTH(card_number, password); "];
  --- [label="Bank checks if the card can be used in this ATM, and the password is correct"];
  s =&gt; c [label="Transaction authorization token with timeout"];
  
  --- [label="ATM makes further requests with transaction token"];
  --- [label="Bank only serves transactions with valid transaction token"];
  
  c =&gt; s [label="WITHDRAW(amount);"];
  --- [label="Bank checks if user have enough fund in account, and amount is within various transaction limits"];
  s =&gt; c [label="successfully withdrew $amount cash"];
  
  --- [label="ATM distributes cash, prompts user for logout"];
  c =&gt; s [label="BYE"];
  --- [label="Bank invalidates auth and transaction token upon request, or invalidates them upon timeout"];
  
}
</desc><defs><style type="text/css">svg.mscgenjs__svg{font-family:Helvetica,sans-serif;font-size:12px;font-weight:normal;font-style:normal;text-decoration:none;background-color:white;stroke:black;stroke-width:2}.mscgenjs__svg path, .mscgenjs__svg rect{fill:none}.mscgenjs__svg .label-text-background{fill:white;stroke:white;stroke-width:0}.mscgenjs__svg .bglayer{fill:white;stroke:white;stroke-width:0}.mscgenjs__svg line{}.mscgenjs__svg .return, .mscgenjs__svg .comment{stroke-dasharray:5,3}.mscgenjs__svg .inline_expression_divider{stroke-dasharray:10,5}.mscgenjs__svg text{color:inherit;stroke:none;text-anchor:middle}.mscgenjs__svg text.anchor-start{text-anchor:start}.mscgenjs__svg .arrow-marker{overflow:visible}.mscgenjs__svg .arrow-style{stroke-width:1}.mscgenjs__svg .arcrow, .mscgenjs__svg .arcrowomit, .mscgenjs__svg .emphasised{stroke-linecap:butt}.mscgenjs__svg .arcrowomit{stroke-dasharray:2,2}.mscgenjs__svg .box, .mscgenjs__svg .entity{fill:white;stroke-linejoin:round}.mscgenjs__svg .inherit{stroke:inherit;color:inherit}.mscgenjs__svg .inherit-fill{fill:inherit}.mscgenjs__svg .watermark{font-size:48pt;font-weight:bold;opacity:0.14}.mscgenjs__svg text.entity-text{text-decoration:underline;}</style><marker orient="auto" id="mscgenjs__svgmethod-black" class="arrow-marker" viewBox="0 0 10 10" refX="9" refY="3" markerUnits="strokeWidth" markerWidth="10" markerHeight="10"><polygon points="1,1  9,3  1,5" class="arrow-style" stroke="black" fill="black"></polygon></marker><marker orient="auto" id="mscgenjs__svgmethod-l-black" class="arrow-marker" viewBox="0 0 10 10" refX="9" refY="3" markerUnits="strokeWidth" markerWidth="10" markerHeight="10"><polygon points="17,1 9,3 17,5" class="arrow-style" stroke="black" fill="black"></polygon></marker></defs><g id="mscgenjs__svg_body" transform="translate(50,3) scale(1,1)"><g id="mscgenjs__svg_background"><rect width="464" height="1056" x="-50" y="-3" class="bglayer"></rect></g><g id="mscgenjs__svg_arcspans"></g><g id="mscgenjs__svg_lifelines"><line x1="70" y1="38" x2="70" y2="84" class="arcrow"></line><line x1="294" y1="38" x2="294" y2="84" class="arcrow"></line><line x1="70" y1="84" x2="70" y2="130" class="arcrow"></line><line x1="294" y1="84" x2="294" y2="130" class="arcrow"></line><line x1="70" y1="130" x2="70" y2="176" class="arcrow"></line><line x1="294" y1="130" x2="294" y2="176" class="arcrow"></line><line x1="70" y1="176" x2="70" y2="222" class="arcrow"></line><line x1="294" y1="176" x2="294" y2="222" class="arcrow"></line><line x1="70" y1="222" x2="70" y2="268" class="arcrow"></line><line x1="294" y1="222" x2="294" y2="268" class="arcrow"></line><line x1="70" y1="268" x2="70" y2="314" class="arcrow"></line><line x1="294" y1="268" x2="294" y2="314" class="arcrow"></line><line x1="70" y1="314" x2="70" y2="360" class="arcrow"></line><line x1="294" y1="314" x2="294" y2="360" class="arcrow"></line><line x1="70" y1="360" x2="70" y2="406" class="arcrow"></line><line x1="294" y1="360" x2="294" y2="406" class="arcrow"></line><line x1="70" y1="406" x2="70" y2="452" class="arcrow"></line><line x1="294" y1="406" x2="294" y2="452" class="arcrow"></line><line x1="70" y1="452" x2="70" y2="498" class="arcrow"></line><line x1="294" y1="452" x2="294" y2="498" class="arcrow"></line><line x1="70" y1="498" x2="70" y2="544" class="arcrow"></line><line x1="294" y1="498" x2="294" y2="544" class="arcrow"></line><line x1="70" y1="544" x2="70" y2="590" class="arcrow"></line><line x1="294" y1="544" x2="294" y2="590" class="arcrow"></line><line x1="70" y1="590" x2="70" y2="636" class="arcrow"></line><line x1="294" y1="590" x2="294" y2="636" class="arcrow"></line><line x1="70" y1="636" x2="70" y2="682" class="arcrow"></line><line x1="294" y1="636" x2="294" y2="682" class="arcrow"></line><line x1="70" y1="682" x2="70" y2="728" class="arcrow"></line><line x1="294" y1="682" x2="294" y2="728" class="arcrow"></line><line x1="70" y1="728" x2="70" y2="774" class="arcrow"></line><line x1="294" y1="728" x2="294" y2="774" class="arcrow"></line><line x1="70" y1="774" x2="70" y2="820" class="arcrow"></line><line x1="294" y1="774" x2="294" y2="820" class="arcrow"></line><line x1="70" y1="820" x2="70" y2="866" class="arcrow"></line><line x1="294" y1="820" x2="294" y2="866" class="arcrow"></line><line x1="70" y1="866" x2="70" y2="912" class="arcrow"></line><line x1="294" y1="866" x2="294" y2="912" class="arcrow"></line><line x1="70" y1="912" x2="70" y2="958" class="arcrow"></line><line x1="294" y1="912" x2="294" y2="958" class="arcrow"></line><line x1="70" y1="958" x2="70" y2="1004" class="arcrow"></line><line x1="294" y1="958" x2="294" y2="1004" class="arcrow"></line><line x1="70" y1="1004" x2="70" y2="1050" class="arcrow"></line><line x1="294" y1="1004" x2="294" y2="1050" class="arcrow"></line></g><g id="mscgenjs__svg_sequence"><g><g><rect width="140" height="38" class="entity"></rect><g><text x="70" y="22.5" class="entity-text "><tspan>ATM</tspan></text></g></g><g><rect width="140" height="38" x="224" class="entity"></rect><g><text x="294" y="22.5" class="entity-text "><tspan>Bank</tspan></text></g></g></g><g><line x1="0" y1="107" x2="364" y2="107" class="comment"></line><g><rect width="225.17" height="14" x="69.41" y="99.5" class="label-text-background"></rect><text x="182" y="110.5" class="empty-text comment-row-text "><tspan>User inserts card; ATM wakes up from idle</tspan></text></g></g><g><line x1="70" y1="153" x2="294" y2="161" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="172.52" height="14" x="95.73" y="137.5" class="label-text-background"></rect><text x="182" y="148.5" class="directional-text method-text "><tspan>ID; ATM auth request with public</tspan></text><rect width="18.67" height="14" x="172.66" y="154.5" class="label-text-background"></rect><text x="182" y="165.5" class="directional-text method-text "><tspan>key</tspan></text></g></g><g><line x1="0" y1="199" x2="364" y2="199" class="comment"></line><g><rect width="278.58" height="14" x="42.7" y="191.5" class="label-text-background"></rect><text x="182" y="202.5" class="empty-text comment-row-text "><tspan>Bank confirms public key belongs to authorized ATM</tspan></text></g></g><g><line x1="294" y1="245" x2="70" y2="253" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="204.11" height="14" x="79.94" y="229.5" class="label-text-background"></rect><text x="182" y="240.5" class="directional-text method-text "><tspan>Auth challenge with random number C</tspan></text></g></g><g><line x1="70" y1="291" x2="294" y2="299" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="174.69" height="14" x="94.64" y="275.5" class="label-text-background"></rect><text x="182" y="286.5" class="directional-text method-text "><tspan>AUTH(sig(C)); sig(C) signed with</tspan></text><rect width="85.8" height="14" x="139.09" y="292.5" class="label-text-background"></rect><text x="182" y="303.5" class="directional-text method-text "><tspan>ATM private key</tspan></text></g></g><g><line x1="0" y1="337" x2="364" y2="337" class="comment"></line><g><rect width="275.86" height="14" x="44.06" y="329.5" class="label-text-background"></rect><text x="182" y="340.5" class="empty-text comment-row-text "><tspan>Bank confirms sig(C) is signed with ATM private key</tspan></text></g></g><g><line x1="294" y1="383" x2="70" y2="391" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="174.09" height="14" x="94.95" y="367.5" class="label-text-background"></rect><text x="182" y="378.5" class="directional-text method-text "><tspan>Auth token with 5 minute timeout</tspan></text></g></g><g><line x1="0" y1="429" x2="364" y2="429" class="comment"></line><g><rect width="234.55" height="14" x="64.72" y="421.5" class="label-text-background"></rect><text x="182" y="432.5" class="empty-text comment-row-text "><tspan>ATM makes further requests with auth token</tspan></text></g></g><g><line x1="0" y1="475" x2="364" y2="475" class="comment"></line><g><rect width="303.5" height="14" x="30.23" y="467.5" class="label-text-background"></rect><text x="182" y="478.5" class="empty-text comment-row-text "><tspan>Bank only serves non-auth requests with valid auth token</tspan></text></g></g><g><line x1="0" y1="521" x2="364" y2="521" class="comment"></line><g><rect width="169.83" height="14" x="97.08" y="513.5" class="label-text-background"></rect><text x="182" y="524.5" class="empty-text comment-row-text "><tspan>ATM prompts user for password</tspan></text></g></g><g><line x1="70" y1="567" x2="294" y2="575" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="212.73" height="14" x="75.63" y="551.5" class="label-text-background"></rect><text x="182" y="562.5" class="directional-text method-text "><tspan>CARD_AUTH(card_number, password); </tspan></text></g></g><g><line x1="0" y1="613" x2="364" y2="613" class="comment"></line><g><rect width="301.94" height="14" x="31.02" y="598" class="label-text-background"></rect><text x="182" y="609" class="empty-text comment-row-text "><tspan>Bank checks if the card can be used in this ATM, and the</tspan></text><rect width="103.36" height="14" x="130.31" y="613" class="label-text-background"></rect><text x="182" y="624" class="empty-text comment-row-text "><tspan>password is correct</tspan></text></g></g><g><line x1="294" y1="659" x2="70" y2="667" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="166.98" height="14" x="98.5" y="643.5" class="label-text-background"></rect><text x="182" y="654.5" class="directional-text method-text "><tspan>Transaction authorization token</tspan></text><rect width="64.02" height="14" x="149.98" y="660.5" class="label-text-background"></rect><text x="182" y="671.5" class="directional-text method-text "><tspan>with timeout</tspan></text></g></g><g><line x1="0" y1="705" x2="364" y2="705" class="comment"></line><g><rect width="269.89" height="14" x="47.05" y="697.5" class="label-text-background"></rect><text x="182" y="708.5" class="empty-text comment-row-text "><tspan>ATM makes further requests with transaction token</tspan></text></g></g><g><line x1="0" y1="751" x2="364" y2="751" class="comment"></line><g><rect width="306.81" height="14" x="28.58" y="743.5" class="label-text-background"></rect><text x="182" y="754.5" class="empty-text comment-row-text "><tspan>Bank only serves transactions with valid transaction token</tspan></text></g></g><g><line x1="70" y1="797" x2="294" y2="805" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="118.22" height="14" x="122.88" y="781.5" class="label-text-background"></rect><text x="182" y="792.5" class="directional-text method-text "><tspan>WITHDRAW(amount);</tspan></text></g></g><g><line x1="0" y1="843" x2="364" y2="843" class="comment"></line><g><rect width="331.55" height="14" x="16.22" y="828" class="label-text-background"></rect><text x="182" y="839" class="empty-text comment-row-text "><tspan>Bank checks if user have enough fund in account, and amount</tspan></text><rect width="177.39" height="14" x="93.3" y="843" class="label-text-background"></rect><text x="182" y="854" class="empty-text comment-row-text "><tspan>is within various transaction limits</tspan></text></g></g><g><line x1="294" y1="889" x2="70" y2="897" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="194.08" height="14" x="84.95" y="873.5" class="label-text-background"></rect><text x="182" y="884.5" class="directional-text method-text "><tspan>successfully withdrew $amount cash</tspan></text></g></g><g><line x1="0" y1="935" x2="364" y2="935" class="comment"></line><g><rect width="241.2" height="14" x="61.39" y="927.5" class="label-text-background"></rect><text x="182" y="938.5" class="empty-text comment-row-text "><tspan>ATM distributes cash, prompts user for logout</tspan></text></g></g><g><line x1="70" y1="981" x2="294" y2="989" class="arc directional method" style="stroke:black" marker-end="url(#mscgenjs__svgmethod-black)"></line><g><rect width="24" height="14" x="169.98" y="965.5" class="label-text-background"></rect><text x="182" y="976.5" class="directional-text method-text "><tspan>BYE</tspan></text></g></g><g><line x1="0" y1="1027" x2="364" y2="1027" class="comment"></line><g><rect width="322.88" height="14" x="20.55" y="1012" class="label-text-background"></rect><text x="182" y="1023" class="empty-text comment-row-text "><tspan>Bank invalidates auth and transaction token upon request, or</tspan></text><rect width="159.42" height="14" x="102.28" y="1027" class="label-text-background"></rect><text x="182" y="1038" class="empty-text comment-row-text "><tspan>invalidates them upon timeout</tspan></text></g></g></g><g id="mscgenjs__svg_notes"></g><g id="mscgenjs__svg_watermark"></g></g></svg>